# Рефакторинг: Устранение дублирования кода в формах создания сущностей

## Проблема
В приложении было обнаружено значительное дублирование кода в трех компонентах:
- `NewBrands.jsx` - создание марки автомобиля
- `NewModel.jsx` - создание модели автомобиля  
- `NewGeneration.jsx` - создание поколения автомобиля

Каждый компонент содержал практически идентичную логику:
- Управление состоянием формы (title, description, loading, toast)
- Обработка отправки формы
- Обработка ошибок
- Структура JSX разметки
- Логика редиректа после успешного создания

## Решение

### 1. Создан кастомный хук `useEntityForm`
**Файл:** `src/shared/hooks/useEntityForm.js`

Хук инкапсулирует всю общую логику управления состоянием формы:
- Управление состоянием полей формы
- Обработка отправки формы
- Управление состоянием загрузки
- Управление уведомлениями (toast)
- Обработка ошибок
- Логика редиректа

### 2. Создан базовый компонент `EntityForm`
**Файл:** `src/shared/EntityForm/EntityForm.jsx`

Компонент предоставляет унифицированную структуру формы:
- Заголовок страницы
- Поля title и description
- Поддержка дополнительных кастомных полей
- Кнопка отправки с состоянием загрузки
- Toast уведомления

### 3. Рефакторинг существующих компонентов

Все три компонента были упрощены до минимума:

**До рефакторинга:**
- NewBrands: 114 строк кода
- NewModel: 114 строк кода  
- NewGeneration: 138 строк кода
- **Итого: 366 строк**

**После рефакторинга:**
- NewBrands: 30 строк кода
- NewModel: 30 строк кода
- NewGeneration: 64 строки кода
- **Итого: 124 строки**

**Экономия: 242 строки кода (66% уменьшение)**

## Преимущества решения

### 1. DRY принцип (Don't Repeat Yourself)
- Устранено дублирование кода
- Общая логика вынесена в переиспользуемые компоненты

### 2. Maintainability (Поддерживаемость)
- Изменения в логике формы нужно делать только в одном месте
- Легче добавлять новые функции (например, валидацию)

### 3. Consistency (Согласованность)
- Все формы создания сущностей имеют одинаковое поведение
- Единообразный UX во всем приложении

### 4. Scalability (Масштабируемость)
- Легко добавлять новые типы сущностей
- Простое расширение функциональности

### 5. Testability (Тестируемость)
- Можно тестировать логику отдельно от UI
- Переиспользование тестов для разных форм

## Архитектура

```
useEntityForm (хук)
    ↓
EntityForm (базовый компонент)
    ↓
┌─────────────┬─────────────┬─────────────┐
│  NewBrands  │  NewModel   │NewGeneration│
│   (30 loc)  │   (30 loc)  │   (64 loc)  │
└─────────────┴─────────────┴─────────────┘
```

## Использование

### Простая форма (Brand, Model):
```jsx
const formState = useEntityForm({
    createFunction: createBrand,
    successMessage: 'Марка успешно создана',
    errorMessage: 'Ошибка при создании марки',
    redirectPath: '/brands'
})

return (
    <EntityForm
        title="Добавить марку автомобиля"
        pageTitle="CarsDB - Создать новую марку"
        formState={formState}
        handleSubmit={handleSubmit}
        descriptionPlaceholder="Введите описание марки..."
    />
)
```

### Форма с дополнительными полями (Generation):
```jsx
const formState = useEntityForm({
    createFunction: createGeneration,
    successMessage: 'Поколение успешно создано',
    errorMessage: 'Ошибка при создании поколения',
    redirectPath: '/generation',
    initialValues: {
        customFields: { after: '1970', befor: '2025' }
    }
})

const customFields = (
    <div>
        <input type="Number" placeholder="Начало" />
        <input type="Number" placeholder="Конец" />
    </div>
)

return (
    <EntityForm
        title="Добавить поколение"
        pageTitle="CarsDB - Создать новое поколение"
        formState={formState}
        handleSubmit={handleSubmit}
        customFields={customFields}
        descriptionPlaceholder="Введите описание поколения..."
    />
)
```

## Расширение функциональности

Для добавления новых типов сущностей достаточно:
1. Создать API функцию для создания сущности
2. Создать компонент, использующий `useEntityForm` и `EntityForm`
3. Настроить роутинг

Никаких изменений в базовых компонентах не требуется.
